<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    
    <t t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">
        
        <!-- Por alguna razón, no se imprime del tamañao correcto sin estos css -->
        <xpath expr="//*[@class='pos-receipt']" position="attributes">
            <attribute name="t-att-style">
                'position: relative; left: 1.2em; font-size: 150%; zoom: 90%;'
            </attribute>
        </xpath>
        
        <!-- Información requerida por la SAT -->
        <xpath expr="//*[@class='pos-receipt-contact']" position="replace">
            <div t-if="state.fel_gt.firma_fel" class="pos-receipt-contact" style="font-size: 100%;">
                <t t-esc="receipt.company.name"/><br/>
                NIT: <t t-esc="receipt.company.vat"/><br/>
                <br/>
                <t t-if="env.pos.invoice_journal_address">
                    <t t-esc="env.pos.invoice_journal_address.name"/><br/>
                    <t t-esc="env.pos.invoice_journal_address.street"/><br/>
                </t>
                <br/>
                <t t-if="state.fel_gt.firma_fel">
                    Documento Tributario Electrónico FEL<br/>
                    Factura Electrónica<br/>
                    Serie: <t t-esc="state.fel_gt.serie_fel || ''"/><br/>
                    Número: <t t-esc="state.fel_gt.numero_fel || ''"/><br/>
                </t>
                <br/>
                <div class="datos_factura">
                    Fecha: <t t-esc="state.fel_gt.fecha_pedido || ''"/><br/>
                    Empleado: <t t-esc="receipt.cashier"/><br/>
                    <br/>
                    NIT: <t t-esc="receipt.client.vat ? receipt.client.vat : 'CF'"/><br/>
                    Nombre: <t t-esc="receipt.client.name"/><br/>
                    Dirección: <t t-esc="receipt.client.street"/><br/><br/>
                </div>
            </div>
        </xpath>
        
        <xpath expr="//*[@class='orderlines']" position="attributes">
            <attribute name="t-if">
                state.fel_gt.firma_fel
            </attribute>
        </xpath>
        
        <!-- Poner el lote en cada linea -->
        <!--
        <xpath expr="//*[@class='orderlines']/t/t[3]" position="inside">
            <div class="pos-receipt-left-padding">
                <t t-set="orderline" t-value="orderlines[line_index]" />
                <t t-if="orderline.pack_lot_lines">
                    <t t-foreach="orderline.pack_lot_lines.models" t-as="lot">
                        <span t-esc="lot.attributes['lot_name']"/>
                    </t>
                </t>
            </div>
        </xpath>
        -->
        
        <!-- Para las facturas que tienen negativos -->
        <!--
        <xpath expr="//*[@class='pos-receipt-amount']" position="before">
            <div>
                <div>SUBTOTAL: <span t-esc='env.pos.format_currency(receipt.total_with_tax-precio_total_descuento)' class="pos-receipt-right-align"/></div>
                <div>DESCUENTO: <span t-esc='env.pos.format_currency(precio_total_descuento)' class="pos-receipt-right-align"/></div>
            </div>
        </xpath>
        -->
        
        <!-- Información del certificador -->
        <xpath expr="//*[@class='before-footer']" position="after">
            <br/>
            <t t-if="state.fel_gt.certificador_fel == 'infile' || !state.fel_gt.certificador_fel">
                Certificador<br/>
                INFILE, S.A.<br/>
                NIT: 12521337<br/>
            </t>
            <t t-if="state.fel_gt.certificador_fel == 'g4s'">
                Certificador<br/>
                G4S DOCUMENTA, S. A.<br/>
                NIT: 60010207<br/>
            </t>
            <t t-if="state.fel_gt.certificador_fel == 'gom'">
                Certificador<br/>
                GOM SOLUTIONS, SOCIEDAD ANONIMA<br/>
                NIT: 95189416<br/>
            </t>
            <t t-if="state.fel_gt.certificador_fel == 'ecofactura'">
                Certificador<br/>
                ECO-FACTURAS<br/>
                NIT: 64281167<br/>
            </t>
            <t t-if="state.fel_gt.certificador_fel == 'digifact'">
                Certificador<br/>
                DIGIFACT SERVICIOS, SOCIEDAD ANONIMA<br/>
                NIT: 77454820<br/>
            </t>
            <t t-if="state.fel_gt.certificador_fel == 'ccg'">
                Certificador<br/>
                Cámara de Comercio de Guatemala<br/>
                NIT: 351598<br/>
            </t>
            <t t-if="state.fel_gt.certificador_fel == 'megaprint'">
                Certificador<br/>
                MEGAPRINT, S.A.<br/>
                NIT: 50510231<br/>
            </t>
            <t t-if="state.fel_gt.firma_fel">
                Autorización: <t t-esc="state.fel_gt.firma_fel || ''"/><br/>
                Fecha Certificación: <t t-esc="state.fel_gt.fecha_pedido || ''"/>
            </t>
            <div t-if='!receipt.footer and !receipt.footer_html'>
                Sujeto a pagos trimestrales ISR<br/>
            </div>
        </xpath>
    </t>

</templates>
